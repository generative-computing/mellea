---
title: "mellea.stdlib.sampling.base"
sidebarTitle: "mellea.stdlib.sampling.base"
description: "Base Sampling Strategies."
---





import { SidebarFix } from "/snippets/SidebarFix.mdx";

<SidebarFix />

## Classes

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />


### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#4ADE8033]/20 text-[#15803D]">CLASS</span> `BaseSamplingStrategy` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L26" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Base class for multiple strategies that rejects samples based on given instructions.



<div className="h-8" />
**Methods:**

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `repair` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L52" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
repair(old_ctx: Context, new_ctx: Context, past_actions: list[Component], past_results: list[ModelOutputThunk], past_val: list[list[tuple[Requirement, ValidationResult]]]) -> tuple[Component, Context]
```

Repair function that is being invoked if not all requirements are fulfilled. It should return a next action component.

**Args:**
- `old_ctx`: The context WITHOUT the last action + output.
- `new_ctx`: The context including the last action + output.
- `past_actions`: List of actions that have been executed (without success).
- `past_results`: List of (unsuccessful) generation results for these actions.
- `past_val`: List of validation results for the results.

**Returns:**
- The next action component and context to be used for the next generation attempt.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `select_from_failure` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L77" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
select_from_failure(sampled_actions: list[Component], sampled_results: list[ModelOutputThunk], sampled_val: list[list[tuple[Requirement, ValidationResult]]]) -> int
```

This function returns the index of the result that should be selected as `.value` iff the loop budget is exhausted and no success.

**Args:**
- `sampled_actions`: List of actions that have been executed (without success).
- `sampled_results`: List of (unsuccessful) generation results for these actions.
- `sampled_val`: List of validation results for the results.

**Returns:**
- The index of the result that should be selected as `.value`.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `sample` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L94" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
sample(self, action: Component[S], context: Context, backend: Backend, requirements: list[Requirement] | None) -> SamplingResult[S]
```

This method performs a sampling operation based on the given instruction.

**Args:**
- `action `: The action object to be sampled.
- `context`: The context to be passed to the sampling strategy.
- `backend`: The backend used for generating samples.
- `requirements`: List of requirements to test against (merged with global requirements).
- `validation_ctx`: Optional context to use for validation. If None, validation_ctx = ctx.
- `format`: output format for structured outputs.
- `model_options`: model options to pass to the backend during generation / validation.
- `tool_calls`: True if tool calls should be used during this sampling strategy.
- `show_progress`: if true, a tqdm progress bar is used. Otherwise, messages will still be sent to flog.

**Returns:**
- A result object indicating the success or failure of the sampling process.

**Raises:**
- `AssertionError`: Asserts that all required components (repair, select_from_failure, validate, and generate) are provided before proceeding with the sampling.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#4ADE8033]/20 text-[#15803D]">CLASS</span> `RejectionSamplingStrategy` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L259" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Simple rejection sampling strategy that just repeats the same call on failure.



<div className="h-8" />
**Methods:**

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `select_from_failure` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L263" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
select_from_failure(sampled_actions: list[Component], sampled_results: list[ModelOutputThunk], sampled_val: list[list[tuple[Requirement, ValidationResult]]]) -> int
```

Always returns the 0th index.

**Args:**
- `sampled_actions`: List of actions that have been executed (without success).
- `sampled_results`: List of (unsuccessful) generation results for these actions.
- `sampled_val`: List of validation results for the results.

**Returns:**
- The index of the result that should be selected as `.value`.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `repair` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L281" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
repair(old_ctx: Context, new_ctx: Context, past_actions: list[Component], past_results: list[ModelOutputThunk], past_val: list[list[tuple[Requirement, ValidationResult]]]) -> tuple[Component, Context]
```

Always returns the unedited, last action.

**Args:**
- `old_ctx`: The context WITHOUT the last action + output.
- `new_ctx`: The context including the last action + output.
- `past_actions`: List of actions that have been executed (without success).
- `past_results`: List of (unsuccessful) generation results for these actions.
- `past_val`: List of validation results for the results.

**Returns:**
- The next action component and context to be used for the next generation attempt.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#4ADE8033]/20 text-[#15803D]">CLASS</span> `RepairTemplateStrategy` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L303" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


A sampling strategy that adds a repair string to the instruction object.



<div className="h-8" />
**Methods:**

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `select_from_failure` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L307" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
select_from_failure(sampled_actions: list[Component], sampled_results: list[ModelOutputThunk], sampled_val: list[list[tuple[Requirement, ValidationResult]]]) -> int
```

Always returns the 0th index.

**Args:**
- `sampled_actions`: List of actions that have been executed (without success).
- `sampled_results`: List of (unsuccessful) generation results for these actions.
- `sampled_val`: List of validation results for the results.

**Returns:**
- The index of the result that should be selected as `.value`.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `repair` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L325" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
repair(old_ctx: Context, new_ctx: Context, past_actions: list[Component], past_results: list[ModelOutputThunk], past_val: list[list[tuple[Requirement, ValidationResult]]]) -> tuple[Component, Context]
```

Adds a description of the requirements that failed to a copy of the original instruction.

**Args:**
- `old_ctx`: The context WITHOUT the last action + output.
- `new_ctx`: The context including the last action + output.
- `past_actions`: List of actions that have been executed (without success).
- `past_results`: List of (unsuccessful) generation results for these actions.
- `past_val`: List of validation results for the results.

**Returns:**
- The next action component and context to be used for the next generation attempt.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#4ADE8033]/20 text-[#15803D]">CLASS</span> `MultiTurnStrategy` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L368" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Rejection sampling strategy with (agentic) multi-turn repair.



<div className="h-8" />
**Methods:**

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `select_from_failure` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L372" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
select_from_failure(sampled_actions: list[Component], sampled_results: list[ModelOutputThunk], sampled_val: list[list[tuple[Requirement, ValidationResult]]])
```

Always returns the last index. The last message from the model will always be returned if all results are failures.

**Args:**
- `sampled_actions`: List of actions that have been executed (without success).
- `sampled_results`: List of (unsuccessful) generation results for these actions.
- `sampled_val`: List of validation results for the results.

**Returns:**
- The index of the result that should be selected as `.value`.


<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />

#### <span className="ml-2 inline-flex items-center rounded-full px-2 py-1 text-[0.7rem] font-bold tracking-wide bg-[#3064E3]/20 text-[#1D4ED8]">FUNC</span> `repair` <sup><a href="https://github.com/generative-computing/mellea/blob/main/mellea/stdlib/sampling/base.py#L390" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
repair(old_ctx: Context, new_ctx: Context, past_actions: list[Component], past_results: list[ModelOutputThunk], past_val: list[list[tuple[Requirement, ValidationResult]]]) -> tuple[Component, Context]
```

Returns a Message with a description of the failed requirements.

**Args:**
- `old_ctx`: The context WITHOUT the last action + output.
- `new_ctx`: The context including the last action + output.
- `past_actions`: List of actions that have been executed (without success).
- `past_results`: List of (unsuccessful) generation results for these actions.
- `past_val`: List of validation results for the results.

**Returns:**
- The next action component and context to be used for the next generation attempt.

<div className="w-full h-px bg-gray-200 dark:bg-gray-700 my-4" />
